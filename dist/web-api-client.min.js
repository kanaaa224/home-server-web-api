// --------------------------------------------------
//  WebAPI クライアント
//  (c) 2025 kanaaa224. All rights reserved.
// --------------------------------------------------

class WebAPIClient{constructor(t="",i="v1"){this.endpoints_url=t,this.specified_api=i,this.endpoints=null,this.called_history=[],this.endpoint={},this.name="",this.url=""}async connect(t=this.endpoints_url,i=this.specified_api){const s=await fetch(t),e=await s.json();this.endpoints=e,this.endpoints_url=t,this.specified_api=i,this.endpoint=this.endpoints[this.specified_api],this.name=this.endpoint.name,this.url=this.endpoint.url}async call(t={},i={}){if(!this.endpoints)throw new Error("api-not-connected");const s=new URL(this.endpoints[this.specified_api].url);for(const[t,e]of Object.entries(i))s.searchParams.set(t,e);const e=await fetch(s.toString(),{method:"POST",body:JSON.stringify(t)}),n=await e.json();if(!n.status)throw new Error("api-bad-status");if("success"!=n.data.result)throw new Error(`api-call-result: failed - ${n.data.value}`);return this.called_history.push({called_at:new Date,requestBody:t,url:s}),n.data.value}}